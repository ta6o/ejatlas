-# coding: utf-8
.row.wide
  .col-md-12
    .hero-unit
      %h1.title
        =mt('Companies to merge')
    .inner
      %p Please type the keywords below, separated by commas.
      %form{:method=>'POST',:action=>'/companies/merging'}
        %textarea{:name=>'keys'}
        %button{:type=>'submit'} Submit
      %hr/
      -@keywords.each do |k,v|
        -next unless v.any?
        .well
          %h3= k
          %form{:method=>'POST',:action=>"/companies/mergethem/"}
            %ul
            -v.each do |s|
              %li.clearfix{:style=>'list-style-type:none'}
                .pull-left
                  &nbsp;
                  %input{:type=>'radio',:name=>"a_#{k}",:value=>s[:id]}
                  &nbsp;
                .pull-left
                  &nbsp;
                  %input{:type=>'checkbox',:name=>"p_#{s[:id]}"}
                  &nbsp;
                .pull-left
                  -if s[:name].length > 48
                    %span{:title=>s[:name]}=s[:name][0..48]+"..."
                  -else
                    %span=s[:name]
                  &nbsp;
                  %span.badge{:title=>s[:confs]}=s[:count]
            %br/
            %button{:type=>'submit'} Merge
            %button{:type=>'submit'} Delete
:javascript
  $(document).ready(function(){
    $('input[type=radio]').on('change',function(e){
      $('input[type=checkbox]').removeAttr('disabled');
      //$(this).parent().next('.pull-left').find('input[type=checkbox]').attr('checked',true);
      $(this).parent().next('.pull-left').find('input[type=checkbox]').attr('disabled',true);
    })
    $('button[type=submit]').on('click',function(e){
      e.preventDefault();
      data = $(this).closest('form').serialize();
      data += "&act="+$(this).text().toLowerCase()
      $.ajax({
        type: 'POST',
        url: '/companies/mergethem',
        data: data, 
        success: function(data,ts){
          console.log(data);
        }
      })
    })
  })

